@prefix sh:   <http://www.w3.org/ns/shacl#> .
@prefix xsd:  <http://www.w3.org/2001/XMLSchema#> .
@prefix prov: <http://www.w3.org/ns/prov#> .
@prefix uofa: <https://uofa.net/vocab#> .
@prefix dct:  <http://purl.org/dc/terms/> .
@prefix schema: <https://schema.org/> .

################################################################
# Dispatcher: pick Minimal vs Complete constraints by profile
################################################################
uofa:UnitOfAssurance_ProfileShape
  a sh:NodeShape ;
  sh:targetClass uofa:UnitOfAssurance ;
  # Must declare a known profile
  sh:property [
    sh:path uofa:conformsToProfile ;
    sh:in ( uofa:ProfileMinimal uofa:ProfileComplete ) ;
    sh:minCount 1 ;
    sh:message "conformsToProfile must be ProfileMinimal or ProfileComplete." ;
  ] ;
  # EITHER MinimalBody when profile = Minimal OR CompleteBody when profile = Complete
  sh:or (
    [
      sh:property [
        sh:path uofa:conformsToProfile ;
        sh:hasValue uofa:ProfileMinimal
      ] ;
      sh:node uofa:UnitOfAssurance_MinimalBody
    ]
    [
      sh:property [
        sh:path uofa:conformsToProfile ;
        sh:hasValue uofa:ProfileComplete
      ] ;
      sh:node uofa:UnitOfAssurance_CompleteBody
    ]
  ) .

################################################################
# Minimal body (applies only when ProfileMinimal is chosen)
################################################################
uofa:UnitOfAssurance_MinimalBody
  a sh:NodeShape ;
  sh:property [
    sh:path uofa:bindsRequirement ;
    sh:nodeKind sh:IRI ;
    sh:minCount 1 ;
    sh:message "Minimal: must bind at least one Requirement (IRI)." ;
  ] ;
  sh:property [
    sh:path uofa:hasValidationResult ;
    sh:nodeKind sh:IRI ;
    sh:minCount 1 ;
    sh:message "Minimal: must include at least one ValidationResult (IRI)." ;
  ] ;
  sh:property [
    sh:path prov:generatedAtTime ;
    sh:datatype xsd:dateTime ;
    sh:minCount 1 ;
    sh:message "Minimal: must have generation timestamp." ;
  ] ;
  sh:property [
    sh:path uofa:hash ;
    sh:minCount 1 ;
    sh:message "Minimal: must include a content hash." ;
  ] ;
  sh:property [
    sh:path uofa:signature ;
    sh:minCount 1 ;
    sh:message "Minimal: must include a digital signature (placeholder ok in synthetic runs)." ;
  ] ;
  sh:property [
    sh:path uofa:hasDecisionRecord ;
    sh:nodeKind sh:IRI ;
    sh:minCount 1 ;
    sh:message "Minimal: must include at least one DecisionRecord (IRI)." ;
  ] .

################################################################
# Complete body (applies only when ProfileComplete is chosen)
################################################################
uofa:UnitOfAssurance_CompleteBody
  a sh:NodeShape ;
  sh:property [
    sh:path uofa:bindsRequirement ; sh:nodeKind sh:IRI ; sh:minCount 1 ;
  ] ;
  sh:property [
    sh:path uofa:bindsModel ; sh:nodeKind sh:IRI ; sh:minCount 1 ;
  ] ;
  sh:property [
    sh:path uofa:bindsDataset ; sh:nodeKind sh:IRI ; sh:minCount 1 ;
  ] ;
  sh:property [
    sh:path uofa:hasValidationResult ; sh:nodeKind sh:IRI ; sh:minCount 1 ;
  ] ;
  sh:property [
    sh:path prov:wasDerivedFrom ; sh:nodeKind sh:IRI ; sh:minCount 1 ;
    sh:message "Complete: link to prior artifact (e.g., parent UoA/run logs)." ;
  ] ;
  sh:property [
    sh:path prov:wasAttributedTo ; sh:nodeKind sh:IRI ; sh:minCount 1 ;
    sh:message "Complete: identify responsible actor or organization." ;
  ] ;
  sh:property [
    sh:path prov:generatedAtTime ; sh:datatype xsd:dateTime ; sh:minCount 1 ;
  ] ;
  sh:property [ sh:path uofa:hash ; sh:minCount 1 ] ;
  sh:property [ sh:path uofa:signature ; sh:minCount 1 ] ;
  sh:property [
    sh:path uofa:credibilityIndex ; sh:datatype xsd:decimal ;
    sh:minInclusive 0 ; sh:maxInclusive 1 ;
  ] ;
  sh:property [
    sh:path uofa:traceCompleteness ; sh:datatype xsd:decimal ;
    sh:minInclusive 0 ; sh:maxInclusive 1 ;
  ] ;
  sh:property [
    sh:path uofa:verificationCoverage ; sh:datatype xsd:decimal ;
    sh:minInclusive 0 ; sh:maxInclusive 1 ;
  ] ;
  sh:property [
    sh:path uofa:validationCoverage ; sh:datatype xsd:decimal ;
    sh:minInclusive 0 ; sh:maxInclusive 1 ;
  ] ;
  sh:property [
    sh:path uofa:uncertaintyCIWidth ; sh:datatype xsd:decimal ; sh:minInclusive 0 ;
  ] ;
  sh:property [
    sh:path uofa:assuranceLevel ; sh:in ( "Low" "Medium" "High" ) ;
  ] ;
  sh:property [
    sh:path uofa:criteriaSet ; sh:nodeKind sh:IRI ;
    sh:message "Complete: reference criteria set used (e.g., VVUQ-90, NASA-7009)." ;
  ] ;
  sh:property [
    sh:path uofa:hasDecisionRecord ; sh:nodeKind sh:IRI ; sh:minCount 1 ;
  ] .
