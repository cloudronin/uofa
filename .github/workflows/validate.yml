      - name: Install deps
        run: |
          python -m pip install --upgrade pip
          pip install jsonschema pyld pyshacl rdflib requests

      - name: JSON / JSON-LD validation
        shell: python
        run: |
          import glob, json, sys
          from pathlib import Path
          from pyld import jsonld
          from urllib.parse import urlparse

          # Optional JSON Schema dev profile
          schema_path = Path("schema/v0.1.jsonld")
          do_schema = schema_path.exists()
          if do_schema:
              from jsonschema import Draft202012Validator
              schema = json.loads(schema_path.read_text())

          # Configure a network-enabled document loader for remote @context
          try:
              from pyld.documentloader import requests as ld_requests
              jsonld.set_document_loader(ld_requests(timeout=20))
          except Exception as e:
              print(f"⚠ Could not set requests document loader: {e}")

          files = sorted(glob.glob("examples/*.json")) + sorted(glob.glob("examples/*.jsonld"))
          if not files:
              print("No example files found in /examples", file=sys.stderr)
              sys.exit(1)

          # Local context fallback (offline/deterministic)
          local_ctx_file = Path("spec/context/v0.1.jsonld")
          local_ctx = None
          if local_ctx_file.exists():
              try:
                  local_ctx = json.loads(local_ctx_file.read_text())["@context"]
              except Exception as e:
                  print(f"⚠ Failed to load local context fallback: {e}")

          failures = 0
          for f in files:
              print(f"\n=== {f} ===")
              try:
                  data = json.loads(Path(f).read_text())
              except Exception as e:
                  print(f"✖ JSON parse error: {e}")
                  failures += 1
                  continue

              # 1) JSON Schema (if present)
              if do_schema:
                  try:
                      Draft202012Validator(schema).validate(data)
                      print("✔ JSON Schema profile OK")
                  except Exception as e:
                      print(f"✖ JSON Schema validation failed: {e}")
                      failures += 1
                      continue

              # 2) JSON-LD compaction
              try:
                  ctx = data.get("@context")
                  # If the example references our canonical or raw GH URL, prefer local context for determinism
                  if isinstance(ctx, str) and ("uofa.net/context/v0.1" in ctx or "context/v0.1.jsonld" in ctx):
                      if local_ctx is not None:
                          compact = jsonld.compact(data, local_ctx)
                      else:
                          # fall back to remote fetch with requests loader
                          compact = jsonld.compact(data, "https://uofa.net/context/v0.1")
                  else:
                      # Unknown context; still attempt compaction (network loader enabled above)
                      compact = jsonld.compact(data, "https://uofa.net/context/v0.1")

                  assert "@context" in compact
                  print("✔ JSON-LD compaction OK (context v0.1)")
              except Exception as e:
                  print(f"✖ JSON-LD compaction failed: {e}")
                  failures += 1

          if failures:
              print(f"\nFailures: {failures}")
              sys.exit(1)
          print("\nAll examples passed basic checks.")
